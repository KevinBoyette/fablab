# Prerequisites

The behavioral and instance layers of the `zitilib` models assume a number of prerequisites to function correctly.

This guide assumes that you're running `fablab` from a Linux (or Unix-like) environment. `fablab` is currently incubating support for execution from Windows hosts, but configuring that is beyond the scope of this guide.

### Ziti

First, you'll need a build of Ziti that is compatible with linux environment expressed by the models. You can find a current build of Ziti at the following location:

https://netfoundry.jfrog.io/netfoundry/ziti-release/ziti-all/

Extract the Ziti binaries into a folder somewhere on your filesystem. You'll want the binaries to be contained in a `bin/` folder. For example, you might want to put the binaries in `~/ziti/bin`.

Once you've extracted the binaries, you'll want to `export` a `ZITI_ROOT` environment variable that points ot the parent folder containing the Ziti `bin/`. For example, if I extracted the binaries into `~/ziti/bin`, I would set:

```
$ export ZITI_ROOT=~/ziti/bin
```

I would recommend also including `ZITI_ROOT/bin` in your `PATH`:

```
$ export PATH=$ZITI_ROOT/bin:$PATH
```

### Terraform

The `zitilib` models all use `terraform` to express their infrastructure. You'll need to have a working `terraform` binary in your path in order to work with these models.

https://www.terraform.io/

### Building fablab

Clone a copy of `fablab` into your usual location for cloned repositories. In these instructions, I've clone `fablab` into `~/Repos/nf/fablab`.

`fablab` requires a `FABLAB_ROOT` environment variable to be set that points to this cloned repository:

```
$ export FABLAB_ROOT=~/Repos/nf/fablab
```

Install a copy of `golang`:

https://golang.org/dl/

Make sure `go` is in your `PATH`.

You're going to need to set a `GOPATH` environment variable. `GOPATH` points to the path where the `go` build will download all of the dependencies required to build `fablab`, and will also locate the resulting `fablab` binary.

I typically use `~/local/fablab` as my `GOPATH` for `fablab`. I also add `~/local/fablab/bin` to my `PATH`, to make `fablab` as convenient to use as possible:

```
$ export GOPATH=~/local/fablab
$ export PATH=$GOPATH/bin:$PATH
```

With all of that configured, you build `fablab` like this:

```
$ cd $GOPATH
$ go install ./...
```

As `go` builds `fablab` you will see a number of messages as it downloads the required dependencies:

```
$ go install ./...
go: downloading github.com/oliveagle/jsonpath v0.0.0-20180606110733-2e52cf6e6852
go: downloading github.com/netfoundry/ziti-foundation v0.0.0-20191204161457-1913130f80f6
go: downloading github.com/netfoundry/ziti-fabric v0.0.0-20191204194843-932014abd752
go: downloading github.com/jinzhu/copier v0.0.0-20190924061706-b57f9002281a
go: downloading github.com/sirupsen/logrus v1.4.2
go: downloading github.com/michaelquigley/pfxlog v0.0.0-20190813191113-2be43bd0dccc
...
```

When complete, you will end up with a `fablab` binary:

```
$ file $GOPATH/bin/fablab
/home/michael/local/fablab/bin/fablab: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, for GNU/Linux 3.2.0, Go BuildID=52VVTRbvR32rMeLxB1Sn/3AGXicQ7r99FIzpmOyPX/9_24bAooenKN2V_23vXi/C_spqtKvdMcSv8LlJq-y, BuildID[sha1]=f4d47f853b55f7da62edcc456e490a070ac329f3, not stripped
```

And if your `PATH` is configured correctly:

```
$ fablab
The Fabulous Laboratory

Usage:
  fablab [command]

Available Commands:
  activate    activate a model
  build       build the configuration for the model
  clean       remove instance data from empty or disposed models
  create      create a fablab instance from a model
  dispose     dispose of all model resources
  dump        dump the resolved model structure
  exec        execute an action
  export      export the instance data to a zip archive
  express     express the infrastructure for the model
  help        Help about any command
  kit         kit the distribution for the model
  list        list objects
  run         operate a model
  ssh         establish an ssh connection to the model
  status      show the environment and active instance status
  sync        synchronize a run kit onto the network
  up          progress through lifecycle runlevels (express -> build -> kit -> sync -> activate)
  use         use an instance (becomes active instance)
  version     display fablab version information

Flags:
  -h, --help      help for fablab
  -v, --verbose   enable verbose logging

Use "fablab [command] --help" for more information about a command.
```

### AWS Access

You'll need AWS credentials that are capable of creating VPCs, instances, and the other items that are necessary to launch an environment on AWS. Make sure you've got your access and secret keys ready.

### SSH Key in AWS

You're going to want to have a named SSH key installed into each region where you plan to site resources. The `zitilib/examples/tiny` model uses the `us-east-1` region by default, so you'll at least need your named SSH key installed in that region.

You're going to need to be running an `ssh-agent`, and that agent should have your SSH key loaded into it.

```
$ ssh-add <path_to_your_key>
$ ssh-add -l
3072 SHA256:Z7tIUW0tNpieeQCBNEm/DLFutTsR/5rCRtZKaViE01k michael@zero-lx.quigley.com (RSA)
```

The `ssh-add -l` command should show the key that you've loaded. If this is not functioning, `fablab` will not work.

### \~/.fablab/bindings.yml

Once you've got all of the above configured, you're ready to create your `~/.fablab/bindings.yml` file. The `bindings.yml` file is your "user preferences" for working with `fablab` models, and stores necessary configuration details to work with the `zitilib` instances.

`~/.fablab/bindings.yml` looks like this:

```
environment:      "new_fablab_user"
credentials:
  aws:
    access_key:   "..."
    secret_key:   "..."
    ssh_key_name: "mquigley"
  ssh:
    key_path:     "/home/michael/.ssh/nf-fablab-michael"
    username:   "fedora"
```

You'll want to set `environment` to a unique name for your instances and objects in AWS. This is effectively the "name" that is tagged onto the objects created for `fablab` instances from your environment.

Replace the `...` in `access_key` and `secret_key` with your AWS credential components. 

Replace `mquigley` with the name of the SSH key that you configured into your AWS account in the "SSH Key in AWS" step above. 

Replace `key_path` with the path to your private key file for the SSH key you configured into AWS.

### Ready

With these prerequisites configured, you should be good to go.


Proceed to [Creating an Instance](02.creating.an.instance.md).